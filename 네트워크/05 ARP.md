# 지난시간) 공인 IP와 사설 IP 주소

| 공인 IP                                                     | 사설 IP                                               |
| ----------------------------------------------------------- | ----------------------------------------------------- |
| <img src="04 OSI 3계층.assets/image-20220318185742213.png"> | <img src="05 ARP.assets/image-20220403065032548.png"> |

- 공인 IP주소는 돈주고 통신사한테 받은 주소, 우리집 안에서 컴퓨터, 핸드폰, 노트북, 태블릿 다 각자 사설 IP 존재
  - 다른 공인 IP라면 사설 IP 주소가 겹칠 수 있다! 그것 때문에 공인, 사설 IP를 나눈 것이니까. (보통 사설 IP는 192.168.X.X 로 구성)
  - 사설 IP 주소 범위
    - `10.0.0.0 ~ 10.255.255.255`
    - `172.16.0.0 ~ 172.31.255.255`
    - `192.168.0.0 ~ 192.168.255.255`

<img src="05 ARP.assets/image-20220403065835420.png">

### 사설 IP에 접근하고싶다면

- 내 노트북에서는 다른 서버에 접속할 수 있지만, 다른 서버에서는 gateway를 거치지 않고 내 노트북으로 바로 올 수 없다.

![image-20220403070045878](05 ARP.assets/image-20220403070045878.png)

#### 포트포워딩 / DMZ

| 포트포워딩                                            | DMZ                                                   |
| ----------------------------------------------------- | ----------------------------------------------------- |
| <img src="05 ARP.assets/image-20220403070348153.png"> | <img src="05 ARP.assets/image-20220403070512398.png"> |

#### 고정 IP 와 유동 IP

- 공인 IP와 사설 IP와는 다른 개념

- 서버의 경우 ip가 바뀌지 않는 고정 ip를 사용하고, 가격이 비싸다

- 일반 가정집의 경우 주기적으로 ip를 회수해서 인터넷을 사용중인 곳에만 유동 ip를 할당한다.
  - ISP(Internet Service Provider) 즉 인터넷 서비스 업체는 각 가정마다 **공인 IP를 유동 IP로 부여**하고, 그 가정집 내의 공유기에서는 **사설 IP를 유동 IP로 부여**하는 것이 일반적이다. 
  - 해킹으로부터도 고정 ip보다는 어느정도 안전하다.
  - 현재 인터넷을 사용하고 있지 않다면 ip를 회수해가고, 다른 인터넷을 사용해야하는 곳에게 ip를 할당해주는 방식

- 가정집에서 웹서버를 키고싶으면 DDNS(Dyanmic DNS) + 포트포워딩을 사용해서 개인적으로 운영할 소규모 웹 서버는 가능

  - DDNS는 동적 ip가 바뀌는걸 감지해서 한 도메인에 할당해주는 것.

    <img src="05 ARP.assets/image-20220403072328772.png">

참고 ) https://www.youtube.com/watch?v=GK3h936Co-k&ab_channel=%EC%96%84%ED%8C%8D%ED%95%9C%EC%BD%94%EB%94%A9%EC%82%AC%EC%A0%84





# ARP(Address Resolution Protocol)

> IP 주소를 이용해 MAC 주소로 변환하는 프로토콜 (반대 : RARP)

ARP는 같은 네트워크 대역에서 통신을 하기 위해 필요한 MAC주소를 IP주소를 이용해 알아오는 프로토콜이다.

같은 네트워크 대역에서 통신을 한다고 할지라도 데이터를 보내기 위해서는 7계층부터 캡슐화를 통해 데이터를 보내기 때문에 IP주소와 MAC주소가 모두 필요하다. 이때 IP주소는 알고 MAC주소는 모르더라도 ARP를 통해 통신이 가능하다.

<img src="05 ARP.assets/image-20220403045612906.png">

<img src="05 ARP.assets/image-20220403045906958.png">



IP주소를 입력했을 때, 컴퓨터끼리 서로 상대방의 MAC주소를 알아오기 위해 ARP를 사용해서 알아온다.

따라서 우리가 IP주소를 입력해도, 컴퓨터가 자동으로 상대방의 MAC주소를 알아오고 그 MAC주소를 갖고 통신을 한다. 

ARP를 사용해서 우리가 직접 할 일은 없지만, 컴퓨터가 계속해서 사용하는 프로토콜이다.

ARP Cache Table은 MAC 주소와 IP주소를 보유한 테이블

ARP는 보안과도 연관이 있는데, ARP spoofing이라는 네트워크 공격이 있다. 되게 옛날부터 있었지만 여전히 공격이 먹히는 네트워크가 많다. (카페 와이파이 등)

*ping 해봤는데 안되면 ICMP 설정 : https://jasmintime.com/248

<br>

### ARP spoofing이란?

https://blog.naver.com/eqqus/140203319928

| 정상   | <img src="05 ARP.assets/image-20220403051904764.png"> |
| ------ | ----------------------------------------------------- |
| 비정상 | <img src="05 ARP.assets/image-20220403051922028.png"> |

- 정상적으로 PC 사이간에 MAC주소를 통해 패킷을 교환하면 MAC 테이블에 해당 MAC 주소가 저장된다. 
- 하지만 스니퍼(공격자)가 개입을 하면 
  - 공격자가 PC A에게 PC B의 MAC 주소가 CC라고 거짓 패킷을 전송
  - 공격자가 PC B에게 PC A의 MAC 주소가 CC라고 거짓 패킷을 전송
  - 공격자는 PC A와 PC B로부터 패킷을 수신하게 되고, 모든 데이터를 읽을 수 있다. 변조해서 보내기도 가능
- ARP 스푸핑을 막는 방법
  - 원래 MAC주소는 동적으로 유지되므로 MAC 주소를 정적으로 사용하여 공격을 막는다. ARP 신호를 받으면 자신의 ARP 테이블을 먼저 확인하고, 정적으로 입력된 MAC주소에 대해서는 주소를 갱신하지 않는다.

<br>

## ARP 헤더 구조

<img src="05 ARP.assets/image-20220403055100027.png">



<br>

## ARP 통신 과정

IP주소로 MAC 주소 알아오는 과정

A가 C에게 통신하고 싶지만 MAC 주소를 모를 때!

<img src="05 ARP.assets/image-20220403062704633.png">

1. A가 C에게 ARP 요청 만들 때 but 목적지 MAC주소를 모르는데 어떻게?
    => `00:00:00:00:00:00` 으로 해놓고 보낸다.
    => IP주소는 알고 있으니까 이 IP주소를 가진 애는 나에게 MAC 주소좀 알려줘! 라고 하는 것

2. ARP(3계층)를 감싸는 이더넷(2계층)의 MAC 주소는 ??

  => `FF:FF:FF:FF:FF:FF` 로 해놓고 보낸다.

  => **BroadCast** (같은 네트워크 대역 전부에게 보내는 것)

<img src="05 ARP.assets/image-20220403063500533.png">

3. 이렇게 만든 요청을 스위치(2계층)에게 보낸다.

​	=> 스위치는 2계층 장비이기 때문에 딱 2계층 프로토콜(이더넷)까지만 Decapsulation해서 본다.

​	=> 현재 모든 주소에게 보내라고 왔으니까 같은 네트워크 대역 모두에게 보낸다.

<img src="05 ARP.assets/image-20220403064137943.png">

4. 같은 네트워크에 속한 모든 단말기에게 ARP가 전달되었다.

   1. Eth(이더넷) 프로토콜 Decapsulation => 모두에게 전달한 것이므로 받고 3계층 열어본다.

   2. ARP Decapsulation => 여기서 본인의 IP주소와 목적지 IP주소가 일치하는지 본다.

      1. 일치하지 않는 경우 패킷을 버린다.

      2. 일치하는 경우(C 컴퓨터), 나에게 요청이 온 것이니까 응답 프로토콜을 만들어서 보낸다.(C는 A의 주소를 알고 있으니까 유니캐스트)

<img src="05 ARP.assets/image-20220403064448003.png">

- 통신했던 컴퓨터들의 주소는 ARP 테이블에 남는다.

- ARP 테이블은 ARP `캐시` 테이블이라서 일정 시간이 지나면 없어진다.

- cmd창에 `arp -a` 라고 쳐보면 볼 수 있다.

  <img src="05 ARP.assets/image-20220403064652225.png">

  

