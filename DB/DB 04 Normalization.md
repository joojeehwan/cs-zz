# DB #4

### 정규화(Normalization)

> 테이블 간에 중복된 데이터를 허용하지 않는 것
>
> 데이터의 중복을 허용하지 않음으로 무결성을 유지할 수 있음

<br>

### 정규화의 목적

- **삽입 / 삭제 / 갱신 이상** 발생 방지

  > 삽입 이상(Insertion Anomaly) : 데이터 **삽입** 시 다른 값도 같이 **삽입됨**
  >
  > 삭제 이상(Delete Anomaly) : 데이터 **삭제** 시 다른 값도 같이 **삭제됨**
  >
  > 갱신 이상(Update Anomaly) : 중복된 데이터 중 **일부만 갱신**되어 데이터의 **불일치** 발생

- 불필요한 데이터 최소화

- DB 구조 확장 용이

<br>

### 정규화 과정

> 도부이결다조 -> 두부이걸다줘?
>
> 하위 정규화 과정은 전부 다 만족해야함.
>
> ex) 3NF인 경우 1, 2NF는 모두 만족

1. 1NF

   - **도메인이 원자값**

     | 학과     | 담당교수       |
     | -------- | -------------- |
     | 경영학과 | 홍길동         |
     | 수학과   | 주영호, 이순신 |

     - 갱신 이상

       UPDATE 교수 SET 학과 = '수학교육과' WHERE 학과 = '수학과' AND 담당교수 = '주영호';

     - 삭제 이상

       DELETE FROM 교수 WHERE 학과 = '수학과' AND 담당교수 = '주영호';

   - 정규화 후

     | 학과     | 담당교수 |
     | -------- | -------- |
     | 경영학과 | 홍길동   |
     | 수학과   | 주영호   |
     | 수학과   | 이순신   |

2. 2NF

   - **부분적 함수 종속 제거**

     | 학번 | 이름   | 학과     | 학과코드 |
     | ---- | ------ | -------- | -------- |
     | 1001 | 홍길동 | 경영학과 | 111111   |
     | 2001 | 주영호 | 수학과   | 112222   |
     | 2002 | 이순신 | 수학과   | 112222   |

     학번 => 이름 + 학과 + 학과코드 (완전 함수 종속)

     학과 => 학과코드 (부분적 함수 종속)

     - 삽입 이상

       경영학과, 수학과 학생 추가 시 중복된 정보인 학과코드를 삽입해야함

     - 갱신 이상

       수학과의 학과코드를 수정할 때 모든 부분을 찾아서 수정해야함

   - 정규화 후

     | 학번 | 이름   | 학과     |
     | ---- | ------ | -------- |
     | 1001 | 홍길동 | 경영학과 |
     | 2001 | 주영호 | 수학과   |
     | 2002 | 이순신 | 수학과   |

     | 학과     | 학과코드 |
     | -------- | -------- |
     | 경영학과 | 111111   |
     | 수학과   | 112222   |

3. 3NF

   - **이행적 함수 종속 제거**

     `X -> Y`, `Y -> Z` => `X -> Z`

     | 학번 | 이름   | 주민등록번호   | 성별 | 학과     |
     | ---- | ------ | -------------- | ---- | -------- |
     | 1001 | 홍길동 | 000101-3123456 | 남   | 경영학과 |
     | 2001 | 주영호 | 991231-1234567 | 남   | 수학과   |
     | 2002 | 이순신 | 000707-1765432 | 남   | 수학과   |

     동명이인이 없다는 가정

     이름 => 주민등록번호, 주민등록번호 => 성별

     - 삽입 이상

       학생을 등록할 때 중복된 정보인 성별을 삽입해야함.

   - 정규화 후

     | 학번 | 이름   | 주민등록번호   | 학과     |
     | ---- | ------ | -------------- | -------- |
     | 1001 | 홍길동 | 000101-3123456 | 경영학과 |
     | 2001 | 주영호 | 991231-1234567 | 수학과   |
     | 2002 | 이순신 | 000707-1765432 | 수학과   |

     | 주민등록번호   | 성별 |
     | -------------- | ---- |
     | 000101-3123456 | 남   |
     | 991231-1234567 | 남   |
     | 000707-1765432 | 남   |


---

3. BCNF (Boyce and Codd Normal Form)
   - **결정자이면서 후보키가 아닌 것 제거**
4. 4NF
   - **다치 종속성 제거**
5. 5NF
   - **조인 종속성 제거**

<br>

### 반정규화(De-normalization)

> 시스템의 성능 향상, 개발 및 운영의 편의성을 위해 **의도적**으로 정규화 원칙을 위배하는 행위
>
> - 디스크 I/O 양이 많아 조회시 성능이 저하될 때
> - 너무 많은 조인으로 인해 성능이 저하될 때
> - 컬럼을 계산하여 조회할 때 성능이 저하될 때
>
> 반정규화를 과도하게 적용하면 데이터의 무결성이 깨질 수 있다.

<br>

### 반정규화 대상

- 특정 범위를 자주 조회하는 경우
- 지나친 조인
- 자주 사용되는 테이블에 접근하는 프로세스의 수가 많은 경우
- 통계성 프로세스에 의해 통계 정보를 필요로 하는 경우

<br>

### 반정규화 기법

1. 테이블 병합

   > 부모 테이블에 자식 테이블의 속성을 삽입하고 자식 테이블 삭제

2. 테이블 수직 분할

   > - 조회 위주의 칼럼과 갱신 위주의 컬럼으로 나뉘는 경우
   > - 특별히 자주 조회되는 컬럼이 있는 경우
   > - 특정 컬럼 크기가 아주 큰 경우
   > - 특정 컬럼에 보안을 적용해야 하는 경우
   >
   > 테이블을 컬럼 단위로 분리하여 저장

3. 테이블 수평 분할

   > 레코드 중에서 특정한 덩어리의 범위만을 주로 액세스 하는 경우에 사용
   >
   > 테이블을 로우 단위로 분리하여 저장

4. 중복 테이블 추가

   > 집계 함수를 이용하여 통계 정보를 계산하는 행위가 너무 많은 데이터를 대상으로 하거나, 여러 테이블에서 필요한 정보를 추출할 경우
   >
   > 특정 통계 테이블을 추가

5. 중복 칼럼 추가

   > 조인에 의해 처리할 때 성능저하를 예방하기 위해
   >
   > 테이블에 중복된 컬럼을 추가함